version: "3.9"
services:
  transmission:
    image: lscr.io/linuxserver/transmission:latest
    container_name: pimilor-transmission
    environment:
      PUID: ${PUID_NAS:-1000}
      PGID: ${PGID_NAS:-1000}
      TZ: ${TZ:-America/Los_Angeles}
      PEERPORT: ${PIMILOR_TRANSMISSION_PORT_INBOUND:-51413}
      TRANSMISSION_WEB_HOME: /config/ui/${PIMILOR_TRANSMISSION_WEBUI}
    logging:
      options:
        max-size: 10m
    ports:
      - ${PIMILOR_TRANSMISSION_PORT_UI:-9091}:9091
      - ${PIMILOR_TRANSMISSION_PORT_INBOUND:-51413}:51413
      - ${PIMILOR_TRANSMISSION_PORT_INBOUND:-51413}:51413/udp
    restart: unless-stopped
    volumes:
      - ${PIMILOR_TRANSMISSION_PATH:-./transmission}:/config
      - cofbilion:/downloads
    deploy:
      labels:
        - homepage.instance.admin.group=PÃ­milor
        - homepage.instance.admin.name=Transmission
        - homepage.instance.admin.description=BT downloader
        - homepage.instance.admin.icon=transmission.svg
        - homepage.instance.admin.href=${PIMILOR_TRANSMISSION_URL:-http://localhost}
        - homepage.instance.admin.widget.type=transmission
        - homepage.instance.admin.widget.url=http://${RAEDORVUDH_IP:-http://localhost}:${PIMILOR_TRANSMISSION_PORT_UI:-9091}
        - homepage.instance.admin.widget.rpcUrl=/transmission/
        - homepage.instance.admin.widget.fields=["leech", "download", "seed", "upload"]
      placement:
        constraints: [node.labels.pimilor == true]
      resources:
        limits:
          cpus: "8.00"
          memory: 15G
        reservations:
          cpus: "6.00"
          memory: 9G

volumes:
  cofbilion:
    driver: local
    driver_opts:
      type: nfs
      o: addr=${NFS_IP},${NFS_OPTIONS}
      device: :${COFBILION_PATH}
